
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Hello Triangle! &#8212; DRTK  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=9dd9a163" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/DRTK_Tutorial_1_hello_triangle';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Simplest Case of Geometry Optimization" href="DRTK_Tutorial_2_optimizing_geometry.html" />
    <link rel="prev" title="Tutorials" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">DRTK</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../installation/index.html">
    Installation
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api_reference/index.html">
    DRTK API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/facebookresearch/DRTK">
    GitHub
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/facebookresearch/DRTK" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-2xl fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../installation/index.html">
    Installation
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api_reference/index.html">
    DRTK API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/facebookresearch/DRTK">
    GitHub
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/facebookresearch/DRTK" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-2xl fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Hello Triangle!</a></li>
<li class="toctree-l1"><a class="reference internal" href="DRTK_Tutorial_2_optimizing_geometry.html">Simplest Case of Geometry Optimization</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Hello Triangle!</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Hello-Triangle!">
<h1>Hello Triangle!<a class="headerlink" href="#Hello-Triangle!" title="Link to this heading">#</a></h1>
<p>In this tutorial, we will create a simple “hello triangle,” which is a “hello world” of graphics programming, using DRTK.</p>
<section id="Imports">
<h2>Imports<a class="headerlink" href="#Imports" title="Link to this heading">#</a></h2>
<p>First, we import <code class="docutils literal notranslate"><span class="pre">drtk</span></code> and <code class="docutils literal notranslate"><span class="pre">torch</span></code>. We will also need <code class="docutils literal notranslate"><span class="pre">save_image</span></code> from <code class="docutils literal notranslate"><span class="pre">torchvision</span></code> and <code class="docutils literal notranslate"><span class="pre">display</span></code> from <code class="docutils literal notranslate"><span class="pre">IPython</span></code> to show images.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">drtk</span>
<span class="kn">import</span> <span class="nn">torch</span> <span class="k">as</span> <span class="nn">th</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">thf</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">torchvision.utils</span> <span class="kn">import</span> <span class="n">save_image</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
I0930 183935.688 _utils_internal.py:314] NCCL_DEBUG env var is set to None
I0930 183935.691 _utils_internal.py:323] NCCL_DEBUG is INFO from /etc/nccl.conf
</pre></div></div>
</div>
</section>
<section id="Preparing-geometry">
<h2>Preparing geometry<a class="headerlink" href="#Preparing-geometry" title="Link to this heading">#</a></h2>
<section id="Vertex-Buffer">
<h3>Vertex Buffer<a class="headerlink" href="#Vertex-Buffer" title="Link to this heading">#</a></h3>
<p>Next we create a tensor that holds vertex positions (also known as vertex buffer), which should have a shape of <span class="math notranslate nohighlight">\((B \times N \times 3)\)</span>, where <span class="math notranslate nohighlight">\(B\)</span> is the batch dimension, <span class="math notranslate nohighlight">\(N\)</span> number of vertices, and <span class="math notranslate nohighlight">\(3\)</span> is the coordinates’ dimension.</p>
<p>In this example, we create a tensor of shape <span class="math notranslate nohighlight">\((1 \times 1 \times 3)\)</span> that holds positions of three vertices of the triangle we want to display a single triangle. The first 2 coordinates coorespond to <span class="math notranslate nohighlight">\((x, y)\)</span> coordinates in the image place, were coordinates <span class="math notranslate nohighlight">\((0, 0)\)</span> correspond to the center of the top-left pixel, and <span class="math notranslate nohighlight">\(( \text{width} - 1, \text{height} - 1)\)</span> corresponds to bottom-right pixel.</p>
<p>Next, we create a tensor to hold the vertex positions (also known as the vertex buffer), which should have a shape of <span class="math notranslate nohighlight">\((B \times N \times 3)\)</span>, where <span class="math notranslate nohighlight">\(B\)</span> is the batch dimension, <span class="math notranslate nohighlight">\(N\)</span> is the number of vertices, and <span class="math notranslate nohighlight">\(3\)</span> represents the coordinates’ dimensions.</p>
<p>In this example, we create a tensor of shape <span class="math notranslate nohighlight">\((1 \times 3 \times 3)\)</span> that holds the positions of the three vertices of the triangle we want to display. The first two coordinate values correspond to the <span class="math notranslate nohighlight">\((x, y)\)</span> coordinates in the image plane, where <span class="math notranslate nohighlight">\((0, 0)\)</span> correspond to the center of the top-left pixel, and <span class="math notranslate nohighlight">\((\text{width} - 1, \text{height} - 1)\)</span> corresponds to the center of the bottom-right pixel. The last coordinate is the <code class="docutils literal notranslate"><span class="pre">z</span></code>, or depth coordinate in camera frame. It
is needed for perspective correct interpolation, z-test, and culling primitive that are behind the camera. Here we set all <code class="docutils literal notranslate"><span class="pre">z</span></code> coordinates to <span class="math notranslate nohighlight">\(1\)</span> for simplicity.</p>
<p>Note: &gt; Top-left cornder of the image will have coordinates <span class="math notranslate nohighlight">\((-0.5, -0.5)\)</span>, and bottom-right corner of the image will have coordinates <span class="math notranslate nohighlight">\((\text{width} - 0.5, \text{height} - 0.5)\)</span>. This matched the <code class="docutils literal notranslate"><span class="pre">align_corner=False</span></code> convention used in PyTorch, which is also in alignment with most of graphics APIs (e.g. OpenGL, Vulkan).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create vertex buffer of shape [1 x n_vertices x 3], here for one triangle `n_vertices` == 3</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">([[[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">511.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">511.5</span><span class="p">,</span> <span class="mf">511.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Index-buffer">
<h3>Index buffer<a class="headerlink" href="#Index-buffer" title="Link to this heading">#</a></h3>
<p>Next, we create a tensor to holds the vertex indices (also known as index buffer), which should have a shape of <span class="math notranslate nohighlight">\((F \times 3)\)</span>, where <span class="math notranslate nohighlight">\(F\)</span> is number of triangles, and <span class="math notranslate nohighlight">\(3\)</span> is the dimension of the vertex indices within the triangle.</p>
<p>Index buffer is needed to construct primitives (triangles, in our case) out of the vertex buffer. It acts as a pointer array, referencing the vertices in the vertex buffer, allowing multiple triangles to share the same vertices.</p>
<p>In our case, since we have only three vertices in total, the index buffer is simply <span class="math notranslate nohighlight">\([0, 1, 2]\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create index buffer of shape [n_faces x 3], here for one triangle `n_faces` == 1</span>
<span class="n">vi</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span><span class="o">.</span><span class="n">int</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Rasterize">
<h2>Rasterize<a class="headerlink" href="#Rasterize" title="Link to this heading">#</a></h2>
<p>Next, we call raterize function. We pass the vertex buffer <code class="docutils literal notranslate"><span class="pre">v</span></code>, index buffer <code class="docutils literal notranslate"><span class="pre">vi</span></code> and specify the size of the image plane.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index_img</span> <span class="o">=</span> <span class="n">drtk</span><span class="o">.</span><span class="n">rasterize</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">vi</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The index image, <code class="docutils literal notranslate"><span class="pre">index_img</span></code>, returned by <code class="docutils literal notranslate"><span class="pre">drtk.rasterize</span></code> function, will contain the value <span class="math notranslate nohighlight">\(0\)</span> for all pixels whose centers are covered by the triangle, and <span class="math notranslate nohighlight">\(-1\)</span> for all other pixels.</p>
<p>In the general case, <code class="docutils literal notranslate"><span class="pre">index_img</span></code> will contain indices corresponding to the triangle index in the index buffer <code class="docutils literal notranslate"><span class="pre">vi</span></code> for the pixels whose centers are covered by that triangle. If multiple triangles cover the same pixel, the index of the triangle with the smallest rasterized depth at that pixel (greater than zero) will be used.</p>
<p>The index image, <code class="docutils literal notranslate"><span class="pre">index_img</span></code> has shape of <span class="math notranslate nohighlight">\((B \times height \times width)\)</span>, where <span class="math notranslate nohighlight">\(B\)</span> is the batch dimension.</p>
<p>Let’s inspect the values and shape of <code class="docutils literal notranslate"><span class="pre">index_img</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape: </span><span class="si">{</span><span class="n">index_img</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min value: </span><span class="si">{</span><span class="n">index_img</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max value: </span><span class="si">{</span><span class="n">index_img</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">save_image</span><span class="p">((</span><span class="n">index_img</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="s2">&quot;img.png&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;img.png&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Shape: torch.Size([1, 512, 512])
Min value: -1
Max value: 0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_DRTK_Tutorial_1_hello_triangle_11_1.png" src="../_images/tutorials_DRTK_Tutorial_1_hello_triangle_11_1.png" />
</div>
</div>
</section>
<section id="Render">
<h2>Render<a class="headerlink" href="#Render" title="Link to this heading">#</a></h2>
<p>Next, we compute the barycentric coordinates image <code class="docutils literal notranslate"><span class="pre">bary_img</span></code>. For each pixel, this tensor will store the barycentric coordinates of the fragment associated with that pixel.</p>
<p>The tensor <code class="docutils literal notranslate"><span class="pre">bary_img</span></code> has a shape of <span class="math notranslate nohighlight">\((B \times 3 \times \text{height} \times \text{width})\)</span>, where <span class="math notranslate nohighlight">\(B\)</span> is the batch dimension, and <span class="math notranslate nohighlight">\(3\)</span> is the dimension of the barycentric coordinates.</p>
<p>For pixels not covered by any triangles, the barycentric coordinates will be set to zero.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">,</span> <span class="n">bary_img</span> <span class="o">=</span> <span class="n">drtk</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">vi</span><span class="p">,</span> <span class="n">index_img</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape of bary: </span><span class="si">{</span><span class="n">bary_img</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min value: </span><span class="si">{</span><span class="n">bary_img</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max value: </span><span class="si">{</span><span class="n">bary_img</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">save_image</span><span class="p">(</span><span class="n">bary_img</span><span class="p">,</span> <span class="s2">&quot;img.png&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;img.png&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Shape of bary: torch.Size([1, 3, 512, 512])
Min value: 0.0
Max value: 0.99853515625
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_DRTK_Tutorial_1_hello_triangle_13_1.png" src="../_images/tutorials_DRTK_Tutorial_1_hello_triangle_13_1.png" />
</div>
</div>
<p>Next, we can use function <code class="docutils literal notranslate"><span class="pre">drtk.interpolate</span></code> to interpolate the attributes of the triangle vertices using the barycentric coordinates. The function returns a tensor of shape <span class="math notranslate nohighlight">\((B \times A \times \text{height} \times \text{width})\)</span>, where <span class="math notranslate nohighlight">\(A\)</span> is the size of the attribute.</p>
<p>For this example, we will asign some colors to the vertices and interpolate them. Note that the attribute buffer should be of shape <span class="math notranslate nohighlight">\((B, A, N)\)</span>, where <span class="math notranslate nohighlight">\(N\)</span> is number of vertices.</p>
<p>Note: &gt; We have to compute <code class="docutils literal notranslate"><span class="pre">mask</span></code> as &gt;&gt; <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span> <span class="pre">mask</span> <span class="pre">=</span> <span class="pre">index_img</span> <span class="pre">!=</span> <span class="pre">-1</span> <span class="pre">&gt;&gt;</span></code></p>
<blockquote>
<div><p>So that we could zero-out values of pixels not covered by the triangle. Unlike <code class="docutils literal notranslate"><span class="pre">drtk.render</span></code>, the <code class="docutils literal notranslate"><span class="pre">drtk.interpolate</span></code> function will not set those pixels to zero.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">va</span> <span class="o">=</span> <span class="n">th</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">([[[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]]])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

<span class="n">mask</span> <span class="o">=</span> <span class="n">index_img</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">rgb_img</span> <span class="o">=</span> <span class="n">drtk</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">vi</span><span class="p">,</span> <span class="n">index_img</span><span class="p">,</span> <span class="n">bary_img</span><span class="p">)</span> <span class="o">*</span> <span class="n">mask</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shape of rgb_img: </span><span class="si">{</span><span class="n">rgb_img</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min value: </span><span class="si">{</span><span class="n">rgb_img</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max value: </span><span class="si">{</span><span class="n">rgb_img</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">save_image</span><span class="p">(</span><span class="n">rgb_img</span><span class="p">,</span> <span class="s2">&quot;img.png&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;img.png&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Shape of rgb_img: torch.Size([1, 3, 512, 512])
Min value: 0.0
Max value: 0.8990218639373779
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_DRTK_Tutorial_1_hello_triangle_15_1.png" src="../_images/tutorials_DRTK_Tutorial_1_hello_triangle_15_1.png" />
</div>
</div>
</section>
<section id="Texturing">
<h2>Texturing<a class="headerlink" href="#Texturing" title="Link to this heading">#</a></h2>
<p>Next, we will add texture coordinates and sample a texture.</p>
<p>Let’s prepare a texture:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">skimage</span>

<span class="n">tex</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">th</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">skimage</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">coffee</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">th</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
    <span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
    <span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">tex</span> <span class="o">=</span> <span class="n">thf</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tex</span> <span class="o">=</span> <span class="n">tex</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">256</span><span class="p">,</span> <span class="p">:</span><span class="mi">256</span><span class="p">]</span>

<span class="n">save_image</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="s2">&quot;img.png&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;img.png&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_DRTK_Tutorial_1_hello_triangle_17_0.png" src="../_images/tutorials_DRTK_Tutorial_1_hello_triangle_17_0.png" />
</div>
</div>
<section id="Texture-Coordinates">
<h3>Texture Coordinates<a class="headerlink" href="#Texture-Coordinates" title="Link to this heading">#</a></h3>
<p>Next, we create a vertex buffer with texture coordinates, and interpolate it with <code class="docutils literal notranslate"><span class="pre">drtk.interpolate</span></code>.</p>
<p>Note that texture coordinates values for non-covered pixels are non-zero. That is intensional, we will remove those pixels after we sample the texture.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">th</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">([[[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
    <span class="c1"># add rotation to make it more interesting</span>
    <span class="o">@</span> <span class="n">th</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">([[[</span><span class="mf">0.707</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.707</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.707</span><span class="p">,</span> <span class="mf">0.707</span><span class="p">]]])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">vt_img</span> <span class="o">=</span> <span class="n">drtk</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="n">vi</span><span class="p">,</span> <span class="n">index_img</span><span class="p">,</span> <span class="n">bary_img</span><span class="p">)</span>

<span class="n">save_image</span><span class="p">(</span><span class="n">th</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">vt_img</span><span class="p">,</span> <span class="n">th</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">vt_img</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">])],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;img.png&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;img.png&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_DRTK_Tutorial_1_hello_triangle_19_0.png" src="../_images/tutorials_DRTK_Tutorial_1_hello_triangle_19_0.png" />
</div>
</div>
</section>
<section id="Sampling-texture">
<h3>Sampling texture<a class="headerlink" href="#Sampling-texture" title="Link to this heading">#</a></h3>
<p>To sample the texture, we simply use <code class="docutils literal notranslate"><span class="pre">torch.nn.functional.grid_sample</span></code>.</p>
<p>We recommed to always useing the following set of flags:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">mode=&quot;bilinear&quot;,</span> <span class="pre">padding_mode=&quot;border&quot;,</span> <span class="pre">align_corners</span> <span class="pre">=</span> <span class="pre">False</span></code></p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rgb_img</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">thf</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
        <span class="n">tex</span><span class="p">,</span>
        <span class="n">vt_img</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
        <span class="n">padding_mode</span><span class="o">=</span><span class="s2">&quot;border&quot;</span><span class="p">,</span>
        <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">*</span> <span class="n">mask</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">save_image</span><span class="p">(</span><span class="n">rgb_img</span><span class="p">,</span> <span class="s2">&quot;img.png&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;img.png&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_DRTK_Tutorial_1_hello_triangle_21_0.png" src="../_images/tutorials_DRTK_Tutorial_1_hello_triangle_21_0.png" />
</div>
</div>
<p>This concludes the “Hello Triangle” tutorial.</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Preparing-geometry">Preparing geometry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Vertex-Buffer">Vertex Buffer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Index-buffer">Index buffer</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Rasterize">Rasterize</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Render">Render</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Texturing">Texturing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Texture-Coordinates">Texture Coordinates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Sampling-texture">Sampling texture</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Meta.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>